appTodos.controller('aboutController', function ($scope) {
    $scope.message = 'Here should be long description for About Page. But Will be only this:' +
        'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut commodo consectetur imperdiet. Sed rutrum velit non metus congue congue. Vivamus id magna eget felis pulvinar dapibus eget a nisl. Pellentesque nec eros ex. Duis feugiat nisi nunc, faucibus pharetra mi viverra ac. Nam ante tellus, facilisis at ipsum sit amet, semper tristique mi. Duis mattis ipsum vitae arcu mollis convallis. Nullam turpis libero, tempus non luctus sit amet, rutrum id sem. Curabitur placerat egestas leo quis imperdiet.' +
        'Maecenas a convallis tellus. Duis dapibus arcu ut lorem porta interdum. Fusce nec ultrices ex, eleifend pharetra dolor. Proin luctus venenatis ante, quis cursus nunc. Sed ut facilisis lorem. Nunc ac ante sed tellus iaculis bibendum. Suspendisse aliquam sit amet velit sed rutrum. Morbi dictum vulputate dictum. Maecenas neque lacus, venenatis quis volutpat ac, porta eget odio.' +
        'Sed in justo arcu. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer porta laoreet sapien, eget lobortis turpis volutpat eu. Aliquam mollis pulvinar est varius cursus. Fusce molestie nunc purus, id eleifend nisi tincidunt a. Phasellus aliquet pellentesque nisl, id ultrices massa. Donec quis turpis quam. Donec dapibus, diam a commodo interdum, arcu nibh rhoncus felis, quis efficitur mauris dui at lacus. Pellentesque venenatis, tellus a tristique dapibus, urna nibh suscipit lacus, eleifend mollis metus nisi eget risus. Etiam tristique, est in molestie lacinia, nisi ante hendrerit felis, eget pulvinar leo magna et quam. Sed fringilla pretium hendrerit. Maecenas sit amet interdum felis, quis convallis justo. Ut auctor pellentesque metus, ac tincidunt velit tincidunt eu. Praesent condimentum nibh turpis, eu molestie velit molestie sed. Aliquam ac posuere ante. Cras rutrum erat orci, quis tempus turpis posuere nec.' +
        'Aliquam nibh leo, eleifend et mollis non, malesuada non erat. Aliquam viverra lobortis nulla, sit amet pharetra turpis ornare at. Nulla facilisi. Morbi quis arcu faucibus, volutpat orci ac, bibendum metus. Cras a arcu eget metus cursus tincidunt. Nunc interdum leo quis nisi pulvinar, in placerat libero ullamcorper. Quisque at mi vitae mi dapibus vehicula quis sit amet arcu.' +
        'Praesent venenatis risus at eros volutpat accumsan. Integer at lorem purus. Sed tincidunt tristique venenatis. Quisque facilisis in mauris ut elementum. Mauris aliquam eget lectus ut commodo. Nam leo libero, ultrices sed dapibus tempus, elementum sed justo. Proin interdum interdum nisl, sed pretium nibh consectetur a. Sed auctor rutrum tellus, id pretium nisl malesuada vitae. Cras fermentum nulla nisi, sit amet semper mauris sagittis vitae. Fusce eget eros bibendum, pulvinar mauris vitae, posuere felis. Aliquam eu hendrerit mi. ';
});
appTodos.controller('homeController', function ($scope) {
    $scope.message = 'Everyone come and see how good i look!';
});
appTodos.controller('loginController', function ($rootScope, $scope, $location, $localStorage, Users, SweetAlert) {
    $scope.message = 'Login Everyone come and see how good i look!';
    $scope.users = {};

    $scope.login = function () {
        if ($scope.loginForm.$valid) {
            Users.login($scope.user).then(function (data) {
                if (data.result == true) {
                    $localStorage.isAuthenticated = true;
                    $localStorage.userRole = data.role;
                    $localStorage.userId = data.id;
                    SweetAlert.swal("You are successfully logged in.", "", "success");
                    $location.path('/');
                } else if (data.result == false) {
                    SweetAlert.swal(data.message, "", "error");
                }
            });
        }
    };

    $scope.reset = function (form) {
        if (form) {
            form.$setPristine();
            form.$setUntouched();
        }
        $scope.user = {};
    };

});
appTodos.controller('MainController', function ($scope, $localStorage, accessFactory) {
    $scope.isAuthenticated = $localStorage.isAuthenticated;

    $scope.checkIfVisible = function(url) {
        return accessFactory.checkPermission(url);
    };
});
appTodos.controller('registrationController', function ($scope, $location, Users, SweetAlert) {
    $scope.users = {};

    $scope.register = function () {
        if ($scope.registerForm.$valid) {
            var count = 0;
            Users.get(null, 'email=' + $scope.user.email).then(function (data) {
                count = data.length;
                if (count == 0) {
                    Users.post($scope.user).then(function (data) {
                        SweetAlert.swal("User successfully created", "", "success");
                        $location.path('/login');
                    });
                } else {
                    SweetAlert.swal("User with same E-mail already exists", "", "error");
                }
            });
        }
    };

    $scope.reset = function (form) {
        if (form) {
            Users.get().then(function(data){
                console.log(data);
            });
            form.$setPristine();
            form.$setUntouched();
        }
        $scope.user = {};
    };
});
appTodos.controller('TodosController', function ($scope, $localStorage, Users, Lists, Todos, ngDialog, SweetAlert) {
    $scope.lists = {};
    $scope.todos = {};

    $scope.reload = function () {
        Lists.get(null, 'userId=' + $localStorage.userId).then(function (data) {
            $scope.lists = data;
        });
    };

    $scope.todosLoad = function() {
        if($localStorage.opened.length > 0) {
            Todos.get(null, 'userId=' + $localStorage.userId + '&listId=' + $localStorage.opened).then(function (data) {
                $scope.todos[$localStorage.opened] = data;
            });
        }

    };

    $scope.createList = function () {
        ngDialog.open({
            template: 'pages/todos/addlist.html',
            scope: $scope,
            controller: function ($scope) {
                $scope.list = {};
                $scope.saveList = function () {
                    if ($scope.addListForm.$valid) {
                        $scope.list.userId = $localStorage.userId;
                        Lists.post($scope.list).then(function (data) {
                            SweetAlert.swal("List successfully added", "", "success");
                            $scope.reload();
                            ngDialog.closeAll();
                        });
                    }
                }
            }
        });
    };

    $scope.editList = function (listId) {
        Lists.get(listId).then(function (data) {
            $scope.list = data[0];
            ngDialog.open({
                template: 'pages/todos/addlist.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.saveList = function () {
                        if ($scope.addListForm.$valid) {
                            Lists.put($scope.list._id, $scope.list).then(function (data) {
                                SweetAlert.swal("List successfully updated", "", "success");
                                $scope.reload();
                                ngDialog.closeAll();
                            });
                        }
                    }
                }
            });
        });
    };

    $scope.removeList = function (listId) {
        Lists.get(listId).then(function (data) {
            $scope.list = data[0];
            ngDialog.open({
                template: 'pages/todos/removelist.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.confirmRemoving = function () {
                        Lists.remove($scope.list._id).then(function (data) {
                            if (data.result == true) {
                                SweetAlert.swal("List successfully remove", "", "success");
                            } else {
                                SweetAlert.swal("Something went wrong while removing!", "", "danger");
                            }
                            $scope.reload();
                            ngDialog.closeAll();
                        });
                    };
                }
            });
        });
    };

    $scope.openList = function (listId) {
        $localStorage.opened = listId;
        $scope.todosLoad();
    };

    $scope.isOpened = function(listId) {
        if(listId == $localStorage.opened) {
            return true;
        }
        return false;
    };

    $scope.addTodo = function(listId) {
        ngDialog.open({
            template: 'pages/todos/addtodo.html',
            scope: $scope,
            controller: function ($scope) {
                $scope.todo = {};
                $scope.saveTodo = function () {
                    if ($scope.addTodoForm.$valid) {
                        $scope.todo.userId = $localStorage.userId;
                        $scope.todo.listId = listId;
                        Todos.post($scope.todo).then(function (data) {
                            SweetAlert.swal("Todo Item successfully added", "", "success");
                            $scope.todosLoad();
                            ngDialog.closeAll();
                        });
                    }
                }
            }
        });
    };

    $scope.removeTodo = function (todoId) {
        Todos.get(todoId).then(function (data) {
            $scope.todo = data[0];
            ngDialog.open({
                template: 'pages/todos/removetodo.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.confirmRemoving = function () {
                        Todos.remove($scope.todo._id).then(function (data) {
                            if (data.result == true) {
                                SweetAlert.swal("Todo successfully remove", "", "success");
                            } else {
                                SweetAlert.swal("Something went wrong while removing!", "", "danger");
                            }
                            $scope.todosLoad();
                            ngDialog.closeAll();
                        });
                    };
                }
            });
        });
    };

    $scope.completeTodo = function (todoId) {
        Todos.get(todoId).then(function (data) {
            $scope.todo = data[0];
            ngDialog.open({
                template: 'pages/todos/completetodo.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.confirmComplete = function () {
                        $scope.todo.completed = true;
                        Todos.put($scope.todo._id, $scope.todo).then(function (data) {
                            SweetAlert.swal("Todo successfully completed", "", "success");
                            $scope.todosLoad();
                            ngDialog.closeAll();
                        });
                    };
                }
            });
        });
    };

    $scope.reopenTodo = function (todoId) {
        Todos.get(todoId).then(function (data) {
            $scope.todo = data[0];
            ngDialog.open({
                template: 'pages/todos/reopentodo.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.confirmReopen = function () {
                        $scope.todo.completed = false;
                        Todos.put($scope.todo._id, $scope.todo).then(function (data) {
                            SweetAlert.swal("Todo successfully Re-Opened", "", "success");
                            $scope.todosLoad();
                            ngDialog.closeAll();
                        });
                    };
                }
            });
        });
    };

    $scope.editTodo = function (todoId) {
        Todos.get(todoId).then(function (data) {
            $scope.todo = data[0];
            ngDialog.open({
                template: 'pages/todos/addtodo.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.saveTodo = function () {
                        if ($scope.addTodoForm.$valid) {
                            Todos.put($scope.todo._id, $scope.todo).then(function (data) {
                                SweetAlert.swal("Todo successfully updated", "", "success");
                                $scope.todosLoad();
                                ngDialog.closeAll();
                            });
                        }
                    }
                }
            });
        });
    };

    $scope.reload();
    $scope.todosLoad();
});
appTodos.controller('UsersController', function ($scope, $location, Users, ngDialog, SweetAlert) {
    $scope.users = {};
    $scope.user = {};

    $scope.reload = function () {
        Users.get().then(function (data) {
            $scope.users = angular.fromJson(data);
        });
    };

    $scope.editModalOpen = function (userId) {
        Users.get(userId).then(function (data) {
            $scope.user = data[0];
            ngDialog.open({
                template: 'pages/users/edit.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.saveEdited = function () {
                        if ($scope.editUserForm.$valid) {
                            if ($scope.user.password == $scope.user.password_confirm) {
                                delete $scope.user.password_confirm;
                                Users.put($scope.user._id, $scope.user).then(function (data) {
                                    SweetAlert.swal("User successfully updated", "", "success");
                                    $scope.reload();
                                    ngDialog.closeAll();
                                });
                            }
                        }
                    }
                }
            });
        });
    };

    $scope.remove = function (userId) {
        Users.get(userId).then(function (data) {
            $scope.user = data[0];
            ngDialog.open({
                template: 'pages/users/remove.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.confirmRemoving = function () {
                        Users.remove($scope.user._id).then(function (data) {
                            if(data.result == true) {
                                SweetAlert.swal("User successfully remove", "", "success");
                            } else {
                                SweetAlert.swal("Something went wrong while removing!", "", "danger");
                            }
                            $scope.reload();
                            ngDialog.closeAll();
                        });
                    };
                }
            });
        });
    };

    $scope.reload();
});